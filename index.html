<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Andres Almiray,Leonid Yanovsky">
<title>Griffon Hibernate5 Plugin</title>
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Griffon Hibernate5 Plugin</h1>
<div class="details">
<span id="author" class="author">Andres Almiray,Leonid Yanovsky</span><br>
<span id="revnumber">version 2.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_Usage">2. Usage</a>
<ul class="sectlevel2">
<li><a href="#_configuration">2.1. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_session_properties">2.1.1. Session Properties</a></li>
<li><a href="#_accessing_the_datasource">2.1.2. Accessing the Datasource</a></li>
<li><a href="#_mappings">2.1.3. Mappings</a></li>
<li><a href="#_bootstrap">2.1.4. Bootstrap</a></li>
</ul>
</li>
<li><a href="#_example">2.2. Example</a></li>
<li><a href="#_events">2.3. Events</a></li>
<li><a href="#_ast_transformation">2.4. AST Transformation</a></li>
<li><a href="#_dsl_descriptors">2.5. DSL Descriptors</a></li>
</ul>
</li>
<li><a href="#_configuration">3. Build Configuration</a>
<ul class="sectlevel2">
<li><a href="#_gradle">3.1. Gradle</a>
<ul class="sectlevel3">
<li><a href="#_automatic">3.1.1. Automatic</a></li>
<li><a href="#_manual">3.1.2. Manual</a></li>
</ul>
</li>
<li><a href="#_maven">3.2. Maven</a></li>
</ul>
</li>
<li><a href="#_modules">4. Modules</a>
<ul class="sectlevel2">
<li><a href="#_hibernate5">4.1. Hibernate5</a></li>
</ul>
</li>
<li><a href="#_links">5. Links</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Hibernate5 plugin enables lightweight access to datasources using <a href="http://hibernate.org/orm/" target="_blank">Hibernate</a>.
This plugin does NOT provide domain classes nor dynamic finders like GORM does.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Usage"><a class="anchor" href="#_Usage"></a>2. Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections describe how you may use this plugin in a project.</p>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>2.1. Configuration</h3>
<div class="paragraph">
<p>This plugin relies on the <a href="http://griffon-plugins.github.io/griffon-datasource-plugin" target="_blank">griffon-datasource-plugin</a>. Please follow the instructions to configure this plugin first.</p>
</div>
<div class="paragraph">
<p>You must create a configuration file named <code>Hibernate5</code> that holds the settings for creating instances of <code><a href="http://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/SessionFactory.html" target="_blank">SessionFactory</a></code>.
This file follows the same standard configuration mechanism as the application&#8217;s <code>Config</code> file, which means you can define the
configuration using</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a properties file</p>
</li>
<li>
<p>a Java file</p>
</li>
<li>
<p>a Groovy script</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows the default settings needed to connect the default database taking into account that each
environment may connect to a different database.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/Hibernate5.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">sessionFactory {

}

environments {
    development {
        sessionFactory {
        }
    }
    test {
        sessionFactory {
        }
    }
    production {
        sessionFactory {
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may configure multiple named SessionFactories (the default factory is aptly named <code>default</code>) as the following snippet
shows</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/Hibernate5.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">sessionFactories {
    internal {
        schema = <span class="string"><span class="delimiter">'</span><span class="content">create-drop</span><span class="delimiter">'</span></span>
        provider_class = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.c3p0.internal.C3P0ConnectionProvider</span><span class="delimiter">&quot;</span></span>
    }
    people {
        mapClassesPattern = <span class="regexp"><span class="delimiter">/</span><span class="content">.*AnotherPerson.*</span><span class="delimiter">/</span></span> <span class="comment">//Will map only classes matching this value</span>
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_session_properties"><a class="anchor" href="#_session_properties"></a>2.1.1. Session Properties</h4>
<div class="paragraph">
<p>The following table summarizes the properties that can be specified inside a <code>sessionFactory</code> block</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create-drop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any value accepted by "hibernate.hbm2ddl.auto"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logSql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines value for "hibernate.show_sql"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formatSql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines value for "hibernate.format_sql"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dialect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String or Class</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines value for "hibernate.dialect"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entityInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String or Class</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namingStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String or Class</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">props</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties or Map</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mappings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional resource mappings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect_on_startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Establishes a connection to the datasource at the beginning of the <code>Startup</code> phase.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expose the connection pool using JMX.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapClassesPattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String or Pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/.*/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps only those classes which are matching mapClassesPattern value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">currentSessionContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current session context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider_class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provider class for "hibernate" connection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_accessing_the_datasource"><a class="anchor" href="#_accessing_the_datasource"></a>2.1.2. Accessing the Datasource</h4>
<div class="paragraph">
<p>The plugin&#8217;s <a href="#_modules">module</a> registers a <code><a href="api/griffon/plugins/hibernate5/Hibernate5Handler.html" target="_blank">Hibernate5Handler</a></code> helper class that defines the base contract
for accessing a datasource and issue SQL queries to it. This class has the following methods</p>
</div>
<div class="listingblock">
<div class="title">griffon.plugins.hibernate5.Hibernate5Handler.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="annotation">@Nullable</span>
&lt;R&gt; R withHbm5Session(<span class="annotation">@Nonnull</span> Hibernate5Callback&lt;R&gt; callback)
    <span class="directive">throws</span> RuntimeHibernate5Exception;

<span class="annotation">@Nullable</span>
&lt;R&gt; R withHbm5Session(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName, <span class="annotation">@Nonnull</span> Hibernate5Callback&lt;R&gt; callback)
    <span class="directive">throws</span> RuntimeHibernate5Exception;

<span class="type">void</span> closeHbm5Session();

<span class="type">void</span> closeHbm5Session(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These method are aware of multiple datasources. If no sessionFactoryName is specified when calling them then the default
datasource will be selected. You can inject an instance of this class anywhere it&#8217;s needed using <code>@Inject</code>. There is one
callback you may use with this method: <code><a href="api/griffon/plugins/hibernate5/Hibernate5Callback.html" target="_blank">Hibernate5Callback</a></code>.</p>
</div>
<div class="paragraph">
<p>This callback is defined using a functional interface approach, which means you can apply lambda expressions if running
with JDK8+ or closures if running Groovy.</p>
</div>
<div class="listingblock">
<div class="title">griffon.plugins.hibernate5.Hibernate5Callback.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Hibernate5Callback</span>&lt;R&gt; {
    R handle(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName, <span class="annotation">@Nonnull</span> Session session);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mappings"><a class="anchor" href="#_mappings"></a>2.1.3. Mappings</h4>
<div class="paragraph">
<p>The plugin can automatically discover mappings that should be added to a <code><a href="http://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/SessionFactory.html" target="_blank">SessionFactory</a></code> as long as they are annotated with <code>@TypeProviderFor</code>.
Hibernate provides two ways to define mapping . One through class + xml.
For example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/griffon/plugins/hibernate5/Person.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span class="keyword">package</span> griffon.plugins.hibernate5

<span class="keyword">import</span> <span class="include">griffon.metadata.TypeProviderFor</span>
<span class="keyword">import</span> <span class="include">groovy.transform.ToString</span>

<span class="annotation">@ToString</span>
<span class="annotation">@TypeProviderFor</span>(Hibernate5Mapping)
<span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>, Hibernate5Mapping {
    <span class="type">int</span> id
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> lastname

    <span class="predefined-type">Map</span> asMap() {
        [
            id      : id,
            name    : name,
            <span class="key">lastname</span>: lastname
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And matching XML file that contains query definitions, such as</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/griffon/plugins/hibernate5/Person.hbm.xml</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE hibernate-mapping PUBLIC
    &quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;
    &quot;http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd&quot;&gt;</span>

<span class="tag">&lt;hibernate-mapping</span> <span class="attribute-name">package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">griffon.plugins.hibernate5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;class</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">table</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PEOPLE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;id</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSON_ID</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;generator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">increment</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">not-null</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">not-null</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/hibernate-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The other way is through class with annotations.
For example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/griffon/plugins/hibernate5/User.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"> *<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span><span class="keyword">package</span> griffon.plugins.hibernate5

<span class="keyword">import</span> <span class="include">griffon.metadata.TypeProviderFor</span>
<span class="keyword">import</span> <span class="include">groovy.transform.ToString</span>

<span class="keyword">import</span> <span class="include">javax.persistence.*</span>

<span class="comment">/**
 * @author Leonid Yanovsky
 */</span>
<span class="annotation">@ToString</span>
<span class="annotation">@TypeProviderFor</span>(Hibernate5Mapping)
<span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">User</span> <span class="directive">implements</span> Hibernate5Mapping {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="type">int</span> id
    <span class="annotation">@Column</span>
    <span class="predefined-type">String</span> name
    <span class="annotation">@Column</span>
    <span class="predefined-type">String</span> lastname

    <span class="predefined-type">Map</span> asMap() {
        [
                id      : id,
                name    : name,
                <span class="key">lastname</span>: lastname
        ]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrap"><a class="anchor" href="#_bootstrap"></a>2.1.4. Bootstrap</h4>
<div class="paragraph">
<p>You may execute arbitrary database calls during connection and disconnection from a <code><a href="http://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/SessionFactory.html" target="_blank">SessionFactory</a></code>. Simply
create a class that implements the <code><a href="api/griffon/plugins/hibernate5/Hibernate5Bootstrap.html" target="_blank">Hibernate5Bootstrap</a></code> interface and register it within a module, for example</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/acme/SampleHibernate5Bootstrap.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="keyword">import</span> <span class="include">griffon.plugins.hibernate5.Hibernate5Bootstrap</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.Session</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.Nonnull</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleHibernate5Bootstrap</span> <span class="directive">implements</span> Hibernate5Bootstrap {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName, <span class="annotation">@Nonnull</span> Session session) {
        <span class="comment">// operations after first connection to datasource</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName, <span class="annotation">@Nonnull</span> Session session) {
        <span class="comment">// operations before disconnecting from the datasource</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/acme/ApplicationModule.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="keyword">import</span> <span class="include">griffon.plugins.hibernate5.Hibernate5Bootstrap</span>;
<span class="keyword">import</span> <span class="include">griffon.core.injection.Module</span>;
<span class="keyword">import</span> <span class="include">org.codehaus.griffon.runtime.core.injection.AbstractModule</span>;
<span class="keyword">import</span> <span class="include">org.kordamp.jipsy.ServiceProviderFor</span>;

<span class="annotation">@ServiceProviderFor</span>(Module.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationModule</span> <span class="directive">extends</span> AbstractModule {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doConfigure() {
        bind(Hibernate5Bootstrap.class)
            .to(SampleHibernate5Bootstrap.class)
            .asSingleton();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>2.2. Example</h3>
<div class="paragraph">
<p>The following is a trivial usage of the <code><a href="api/griffon/plugins/hibernate5/Hibernate5Handler.html" target="_blank">Hibernate5Handler</a></code> inside a Java service</p>
</div>
<div class="listingblock">
<div class="title">com.acme.SampleService.java</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme</span>;

<span class="keyword">import</span> <span class="include">griffon.core.artifact.GriffonService</span>;
<span class="keyword">import</span> <span class="include">griffon.metadata.ArtifactProviderFor</span>;
<span class="keyword">import</span> <span class="include">org.codehaus.griffon.runtime.core.artifact.AbstractGriffonService</span>;

<span class="keyword">import</span> <span class="include">griffon.plugins.hibernate5.Hibernate5Handler</span>;
<span class="keyword">import</span> <span class="include">griffon.plugins.hibernate5.Hibernate5Callback</span>;
<span class="keyword">import</span> <span class="include">org.hibernate.Session</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.Nonnull</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="annotation">@ArtifactProviderFor</span>(GriffonService.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleService</span> <span class="directive">extends</span> AbstractGriffonService {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Hibernate5Handler hibernate5Handler;

    <span class="directive">public</span> <span class="predefined-type">String</span> getPersonName(<span class="directive">final</span> <span class="type">int</span> id) {
         <span class="keyword">return</span> hibernate5Handler.withHbm4Session(<span class="keyword">new</span> Hibernate5Callback&lt;<span class="predefined-type">String</span>&gt;() {
             <span class="directive">public</span> <span class="predefined-type">String</span> handle(<span class="annotation">@Nonnull</span> <span class="predefined-type">String</span> sessionFactoryName, <span class="annotation">@Nonnull</span> Session session) {
                 Person person = (Person) session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Person where id = </span><span class="delimiter">&quot;</span></span> + id).uniqueResult();
                 <span class="keyword">return</span> person != <span class="predefined-constant">null</span> ? person.getName() : <span class="predefined-constant">null</span>;
         });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the Groovy version of it</p>
</div>
<div class="listingblock">
<div class="title">com.acme.SampleService.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span class="keyword">package</span> com.acme

<span class="keyword">import</span> <span class="include">griffon.core.artifact.GriffonService</span>
<span class="keyword">import</span> <span class="include">griffon.metadata.ArtifactProviderFor</span>

<span class="keyword">import</span> <span class="include">griffon.plugins.hibernate5.Hibernate5Handler</span>
<span class="keyword">import</span> <span class="include">org.hibernate.Session</span>

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="annotation">@ArtifactProviderFor</span>(GriffonService)
<span class="type">class</span> <span class="class">SampleService</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Hibernate5Handler hibernate5Handler

    <span class="predefined-type">String</span> getPersonName(<span class="type">int</span> id) {
         hibernate5Handler.withHbm4Session { <span class="predefined-type">String</span> sessionFactoryName, Session session -&gt;
             session.createQuery(<span class="string"><span class="delimiter">'</span><span class="content">from Person where id = </span><span class="delimiter">'</span></span> + id).uniqueResult()?.name
         }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_events"><a class="anchor" href="#_events"></a>2.3. Events</h3>
<div class="paragraph">
<p>The following events will be triggered by <code><a href="api/griffon/plugins/hibernate5/Hibernate5Handler.html" target="_blank">Hibernate5Handler</a></code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Hibernate5ConnectStart(String sessionFactoryName, Map&lt;String, Object&gt; config)</dt>
<dd>
<p>Triggered before connecting to the datasource.</p>
</dd>
<dt class="hdlist1">Hibernate5ConfigurationAvailable(Map&lt;String, Object&gt; options)</dt>
<dd>
<p>Triggered after the session&#8217;s configuration is ready. The map
contains the following keys:</p>
<div class="ulist">
<ul>
<li>
<p>configuration; type=org.hibernate.cfg.Configuration</p>
</li>
<li>
<p>dataSourceName; type=java.lang.String</p>
</li>
<li>
<p>sessionConfiguration; type=java.util.Map</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Hibernate5ConnectEnd(String sessionFactoryName, Map&lt;String, Object&gt; config, SessionFactory factory)</dt>
<dd>
<p>Triggered after connecting to the datasource.</p>
</dd>
<dt class="hdlist1">Hibernate5DisconnectStart(String sessionFactoryName, Map&lt;String, Object&gt; config, SessionFactory factory)</dt>
<dd>
<p>Triggered before disconnecting from the datasource.</p>
</dd>
<dt class="hdlist1">Hibernate5DisconnectEnd(String sessionFactoryName, Map&lt;String, Object&gt; config)</dt>
<dd>
<p>Triggered after disconnecting from the datasource.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
DataSource events may be triggered during connection and disconnection from a <code><a href="http://docs.jboss.org/hibernate/orm/4.3/javadocs/org/hibernate/SessionFactory.html" target="_blank">SessionFactory</a></code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ast_transformation"><a class="anchor" href="#_ast_transformation"></a>2.4. AST Transformation</h3>
<div class="paragraph">
<p>You can apply the <code><a href="api/griffon/transform/Hibernate5Aware.html" target="_blank">@Hibernate5Aware</a></code> AST transformation on any class. This injects the behavior of <code><a href="api/griffon/plugins/hibernate5/Hibernate5Handler.html" target="_blank">Hibernate5Handler</a></code>
into said class. The previous Groovy service example can be rewritten as follows</p>
</div>
<div class="listingblock">
<div class="title">com.acme.SampleService.groovy</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span class="keyword">package</span> com.acme

<span class="keyword">import</span> <span class="include">griffon.core.artifact.GriffonService</span>
<span class="keyword">import</span> <span class="include">griffon.metadata.ArtifactProviderFor</span>
<span class="keyword">import</span> <span class="include">griffon.transform.Hibernate5Aware</span>

<span class="keyword">import</span> <span class="include">org.hibernate.Session</span>

<span class="annotation">@Hibernate5Aware</span>
<span class="annotation">@ArtifactProviderFor</span>(GriffonService)
<span class="type">class</span> <span class="class">SampleService</span> {
    <span class="predefined-type">String</span> getPersonName(<span class="type">int</span> id) {
         withHbm4Session { <span class="predefined-type">String</span> sessionFactoryName, Session session -&gt;
             session.createQuery(<span class="string"><span class="delimiter">'</span><span class="content">from Person where id = </span><span class="delimiter">'</span></span> + id).uniqueResult()?.name
         }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dsl_descriptors"><a class="anchor" href="#_dsl_descriptors"></a>2.5. DSL Descriptors</h3>
<div class="paragraph">
<p>This plugin provides DSL descriptors for Intellij IDEA and Eclipse (provided you have the Groovy Eclipse plugin installed).
These descriptors are found inside the <code>griffon-hibernate5-groovy-compile-2.0.0.jar</code>, with locations</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dsdl/griffon_hibernate5.dsld</p>
</li>
<li>
<p>gdsl/griffon_hibernate5.gdsl</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>3. Build Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gradle"><a class="anchor" href="#_gradle"></a>3.1. Gradle</h3>
<div class="paragraph">
<p>You have two options for configuring this plugin: automatic and manual.</p>
</div>
<div class="sect3">
<h4 id="_automatic"><a class="anchor" href="#_automatic"></a>3.1.1. Automatic</h4>
<div class="paragraph">
<p>As long as the project has the <code>org.codehaus.griffon.griffon</code> plugin applied to it you
may include the following snippet in <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">dependencies {
    griffon 'org.codehaus.griffon.plugins:griffon-hibernate5-plugin:2.0.0'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>griffon</code> plugin will take care of the rest given its configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manual"><a class="anchor" href="#_manual"></a>3.1.2. Manual</h4>
<div class="paragraph">
<p>You will need to configure any of the following blocks depending on your setup</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">dependencies {
    compile 'org.codehaus.griffon.plugins:griffon-hibernate5-core:2.0.0'
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Compile Only</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">dependencies {
    compileOnly 'org.codehaus.griffon.plugins:griffon-hibernate5-groovy-compile:2.0.0'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven"><a class="anchor" href="#_maven"></a>3.2. Maven</h3>
<div class="paragraph">
<p>First configure the <code>griffon-hibernate5-plugin</code> BOM in your POM file, by placing the following
snippet before the <code>&lt;build&gt;</code> element</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.codehaus.griffon.plugins<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>griffon-hibernate5-plugin<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.0.0<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next configure dependencies as required by your particular setup</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.griffon.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>griffon-hibernate5-core<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Provided scope</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.griffon.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>griffon-hibernate5-groovy-compile<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to configure all <code>-compile</code> dependencies with the maven-surefire-plugin, like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;classpathDependencyExcludes&gt;</span>
            <span class="tag">&lt;classpathDependencyExclude&gt;</span>
                org.codehaus.griffon:griffon-hibernate5-groovy-compile
            <span class="tag">&lt;/classpathDependencyExclude&gt;</span>
        <span class="tag">&lt;/classpathDependencyExcludes&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modules"><a class="anchor" href="#_modules"></a>4. Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections display all bindings per module. Use this information to
successfully override a binding on your own modules or to troubleshoot a module
binding if the wrong type has been applied by the Griffon runtime.</p>
</div>
<div class="sect2">
<h3 id="_hibernate5"><a class="anchor" href="#_hibernate5"></a>4.1. Hibernate5</h3>
<div class="paragraph">
<p>Module name: <code>hibernate5</code></p>
</div>
<div class="paragraph">
<p>Depends on: <code>datasource</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">bind(<span class="predefined-type">ResourceBundle</span>.class)
    .withClassifier(named(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate5</span><span class="delimiter">&quot;</span></span>))
    .toProvider(<span class="keyword">new</span> ResourceBundleProvider(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hibernate5</span><span class="delimiter">&quot;</span></span>))
    .asSingleton();

bind(<span class="predefined-type">Configuration</span>.class)
    .withClassifier(named(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate5</span><span class="delimiter">&quot;</span></span>))
    .to(DefaultHibernate5Configuration.class)
    .asSingleton();

bind(Hibernate5Storage.class)
    .to(DefaultHibernate5Storage.class)
    .asSingleton();

bind(Hibernate5Factory.class)
    .to(DefaultHibernate5Factory.class)
    .asSingleton();

bind(Hibernate5Handler.class)
    .to(DefaultHibernate5Handler.class)
    .asSingleton();

bind(GriffonAddon.class)
    .to(Hibernate5Addon.class)
    .asSingleton();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links"><a class="anchor" href="#_links"></a>5. Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="api/index.html" target="_blank">Javadoc</a></p>
</div>
<div class="paragraph">
<p><a href="api-src/index.html" target="_blank">API Sources</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.0.0<br>
Last updated 2017-09-05 12:31:23 +00:00
</div>
</div>
</body>
</html>